{"name":"main.luanb","content":{"cells":{"0":{"code":"local sqlite3 = require(\"lsqlite3\")\r\nlocal dbAdmin = require(\"@rakis/DbAdmin\")\r\n \r\ndb = sqlite3.open_memory()\r\nadmin=dbAdmin.new(db)\r\n\r\n\r\nreturn \"ok\"\r\n","output":"ok","type":"CODE","editing":true},"d6ac18a9-f167-4beb-bdd4-7d01e62a9b68":{"code":"USERS = [[\r\nCREATE TABLE IF NOT EXISTS User (\r\n  id TEXT PRIMARY KEY,\r\n  pid TEXT,\r\n  username TEXT NOT NULL UNIQUE,\r\n  email TEXT NOT NULL UNIQUE,\r\n  password_hash TEXT NOT NULL,\r\n  full_name TEXT NOT NULL,\r\n  mobile_number TEXT NOT NULL,\r\n  mobile_visibility BOOLEAN DEFAULT TRUE,\r\n  gender TEXT CHECK(gender IN ('MALE', 'FEMALE', 'male', 'female', 'Male', 'Female')),\r\n  date_of_birth TEXT,\r\n  rewards INTEGER DEFAULT 0,\r\n  profile_picture_url TEXT,\r\n  bio TEXT,\r\n  preferences TEXT,\r\n  wallet_address TEXT,\r\n  created_at TEXT DEFAULT CURRENT_TIMESTAMP\r\n);\r\n]]\r\n\r\nROOMS = [[\r\nCREATE TABLE IF NOT EXISTS Room (\r\n  id TEXT PRIMARY KEY,\r\n  pid TEXT,\r\n  user_id TEXT,\r\n  members_max INTEGER DEFAULT 1,\r\n  title TEXT,\r\n  description TEXT,\r\n  address TEXT NOT NULL,\r\n  city TEXT NOT NULL,\r\n  state TEXT NOT NULL,\r\n  pin_code TEXT NOT NULL,\r\n  country TEXT NOT NULL,\r\n  price INTEGER,\r\n  looking_for TEXT NOT NULL,\r\n  available_from TEXT,\r\n  available_to TEXT,\r\n  highlights TEXT,\r\n  amenities TEXT,\r\n  created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n  FOREIGN KEY(user_id) REFERENCES User(id)\r\n);\r\n]]\r\n\r\nREVIEWS = [[\r\nCREATE TABLE IF NOT EXISTS Review (\r\n  id TEXT PRIMARY KEY,\r\n  pid TEXT,\r\n  from_user_id TEXT,\r\n  to_user_id TEXT,\r\n  room_id TEXT,\r\n  rating INTEGER CHECK(rating >= 1 AND rating <= 5),\r\n  comment TEXT,\r\n  created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n  FOREIGN KEY(from_user_id) REFERENCES User(id),\r\n  FOREIGN KEY(to_user_id) REFERENCES User(id),\r\n  FOREIGN KEY(room_id) REFERENCES Room(id)\r\n);\r\n]]\r\n\r\nfunction initDb()\r\n  db:exec(USERS)\r\n  db:exec(ROOMS)\r\n  db:exec(REVIEWS)\r\n  return admin:tables()\r\nend\r\n\r\nreturn initDb()\r\n\r\n\r\n\r\n","output":"{ \u001b[32m\"User\"\u001b[0m, \u001b[32m\"Room\"\u001b[0m, \u001b[32m\"Review\"\u001b[0m }","type":"CODE","editing":true},"5c0904de-72e7-426c-ab9e-5293cabf8ef7":{"code":"Handlers.add(\r\n  \"Roomzy.Register\",\r\n  function(msg)\r\n    return msg.Action == \"Register\"\r\n  end,\r\n  function(msg)\r\n    local insertQuery = string.format([[ \r\n      INSERT INTO User (ID, PID, Username, Email, Password_Hash, Full_Name, Mobile_Number, Mobile_Visibility, Gender, Date_Of_Birth, Profile_Picture_URL, Rewards, Wallet_Address)\r\n      VALUES (\"%s\", \"%s\", \"%s\", \"%s\", \"%s\", \"%s\", \"%s\", %d, \"%s\", \"%s\", \"%s\", %d, \"%s\")]],\r\n      msg.ID, msg.From, msg.Username, msg.Email, msg.Password, msg.Full_Name, msg.Mobile_Number, msg.Mobile_Visibility, msg.Gender, msg.Date_Of_Birth, msg.Profile_Picture_URL, msg.Rewards or 0, msg.Wallet_Address)\r\n    admin:exec(insertQuery)\r\n    Send({Target = msg.From, Action = \"Registered\", DATA = \"Successfully Registered\"})\r\n  end\r\n)\r\n","output":"\"undefined\"","type":"CODE","editing":true}},"cellOrder":["0","d6ac18a9-f167-4beb-bdd4-7d01e62a9b68","5c0904de-72e7-426c-ab9e-5293cabf8ef7"]},"language":"lua","type":"NOTEBOOK"}